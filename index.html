<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pad 文档扫描器（本地化 Tesseract + OpenCV）</title>
  <link rel="stylesheet" href="./style.css" />

  <!-- OpenCV 的 wasm 定位（若你的 opencv.js 需要），无副作用 -->
  <script>
    window.Module = { locateFile: (path) => './' + path };
  </script>

  <!-- 加载顺序：opencv.js → tesseract.min.js → app.js（defer） -->
  <!-- 重要：不要添加任何外部脚本（例如 at.alicdn.com 的 iconfont JS），以免被 CSP 阻止 -->
  <script src="./opencv.js"></script>
  <script src="./tesseract/tesseract.min.js"></script>
  <script src="./app.js" defer></script>
</head>
<body>
  <header>
    <h1>Pad 文档扫描器</h1>
    <p>自动识别倾斜 A4、精准定位并生成高清扫描件</p>
  </header>

  <main>
    <section class="camera-section">
      <div class="video-wrapper">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="overlay" class="overlay"></canvas>
        <div id="status" class="status">初始化中…</div>
      </div>

      <div class="controls">
        <button id="startBtn">启动相机</button>
        <button id="snapBtn" disabled>手动拍摄</button>

        <label class="upload">
          <input type="file" id="fileInput" accept="image/*" />
          <span class="upload-btn">上传图片生成扫描件</span>
        </label>

        <label class="toggle">
          <input type="checkbox" id="autoCapture" checked />
          <span>自动抓拍（检测到稳定 A4）</span>
        </label>

        <div class="options">
          <label>
            增强模式：
            <select id="enhanceMode">
              <option value="auto" selected>自动（推荐）</option>
              <option value="binarize">纯黑白（阈值）</option>
              <option value="color">保留彩色</option>
            </select>
          </label>
          <label>
            输出分辨率：
            <select id="outputSize">
              <option value="m">中（约 1600×2300）</option>
              <option value="h" selected>高（约 2400×3400）</option>
              <option value="uh">超高（约 3300×4700）</option>
            </select>
          </label>
        </div>

        <div class="options">
          <button id="rotateLeftBtn">左转90°</button>
          <button id="rotateRightBtn">右转90°</button>
          <button id="rotate180Btn">旋转180°</button>
        </div>
      </div>
    </section>

    <section class="result-section">
      <h2>扫描结果</h2>
      <div class="result-wrapper">
        <canvas id="resultCanvas"></canvas>
      </div>
      <div class="result-actions">
        <button id="downloadPng" disabled>下载 PNG</button>
        <button id="downloadJpg" disabled>下载 JPG</button>
      </div>
    </section>

    <section class="tips">
      <h2>使用提示</h2>
      <ul>
        <li>将 A4 纸置于纯色背景，避免与背景同色以提升识别稳定性。</li>
        <li>保持充足光照，避免强反光；系统会自动做光照均衡处理。</li>
        <li>如出现横向或倒置，系统会自动矫正；也可使用手动旋转按钮一键修正。</li>
      </ul>
    </section>
  </main>

  <footer>
    <small>© 2026 文档扫描演示 · 本地化 Tesseract.js & OpenCV.js</small>
  </footer>
</body>
</html>
